<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Traducteur temps réel EN → FR</title>
  <style>
    body{font-family:sans-serif;margin:0;background:#111;color:#fff;padding:20px}
    button{padding:8px 14px;margin:4px;font-size:14px}
    textarea{width:100%;height:120px;margin-top:6px}
    .status{margin-top:10px;font-size:14px;color:#aaa}
  </style>
</head>
<body>
  <h1>Traducteur temps réel — Anglais → Français</h1>
  <p>Parle en anglais au micro, et la traduction française apparaîtra en dessous.</p>
  <div>
    <button id="startBtn">🎙️ Démarrer</button>
    <button id="stopBtn" disabled>⏹️ Arrêter</button>
  </div>
  <h3>Texte détecté (anglais)</h3>
  <textarea id="transcript" readonly></textarea>
  <h3>Traduction (français)</h3>
  <textarea id="translation" readonly></textarea>
  <div class="status" id="status">État : inactif</div>

<script>
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognizer, recognizing=false;
const startBtn=document.getElementById('startBtn');
const stopBtn=document.getElementById('stopBtn');
const transcriptEl=document.getElementById('transcript');
const translationEl=document.getElementById('translation');
const statusEl=document.getElementById('status');

function initRecog(){
  recognizer=new SpeechRecognition();
  recognizer.lang='en-US';
  recognizer.continuous=true;
  recognizer.interimResults=true;
  recognizer.onstart=()=>{
    recognizing=true;statusEl.textContent='État : écoute…';
    startBtn.disabled=true;stopBtn.disabled=false;
  };
  recognizer.onend=()=>{
    recognizing=false;statusEl.textContent='État : inactif';
    startBtn.disabled=false;stopBtn.disabled=true;
  };
  recognizer.onresult=(e)=>{
    let interim='',final='';
    for(let i=e.resultIndex;i<e.results.length;i++){
      const res=e.results[i];
      if(res.isFinal){final+=res[0].transcript;}else{interim+=res[0].transcript;}
    }
    transcriptEl.value=(transcriptEl.value+' '+final+' '+interim).trim();
    if(final.trim()) translate(final.trim());
  };
}

async function translate(txt){
  statusEl.textContent='Traduction en cours…';
  try{
    const r=await fetch("https://libretranslate.de/translate",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({q:txt,source:"en",target:"fr",format:"text"})
    });
    const d=await r.json();
    translationEl.value+=(translationEl.value?'\n':'')+d.translatedText;
    statusEl.textContent='État : traduction OK';
  }catch(e){
    statusEl.textContent='Erreur traduction';
  }
}

startBtn.onclick=async()=>{
  try{
    await navigator.mediaDevices.getUserMedia({audio:true});
    if(!recognizer) initRecog();
    recognizer.start();
  }catch(e){statusEl.textContent='Micro non disponible';}
};
stopBtn.onclick=()=>recognizer.stop();
</script>
</body>
</html>
