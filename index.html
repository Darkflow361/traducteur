<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Traducteur temps r√©el EN ‚Üí FR</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body{
      font-family:'Poppins', sans-serif;
      margin:0;
      background:linear-gradient(135deg,#0f172a,#1e293b);
      color:#f8fafc;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:20px;
    }
    h1{margin-top:0;text-align:center;font-weight:600;}
    .card{
      background:rgba(255,255,255,0.05);
      backdrop-filter:blur(10px);
      border-radius:12px;
      padding:20px;
      width:100%;
      max-width:800px;
      box-shadow:0 4px 20px rgba(0,0,0,0.4);
    }
    button{
      padding:10px 16px;
      margin:4px;
      font-size:15px;
      border:none;
      border-radius:8px;
      cursor:pointer;
      transition:background 0.3s;
      font-weight:600;
    }
    .start{background:#22c55e;color:white;}
    .start:hover{background:#16a34a;}
    .stop{background:#ef4444;color:white;}
    .stop:hover{background:#dc2626;}
    textarea{
      width:100%;
      height:120px;
      margin-top:6px;
      border-radius:8px;
      border:none;
      padding:10px;
      font-size:14px;
      resize:none;
      background:rgba(255,255,255,0.08);
      color:#f8fafc;
    }
    .status{margin-top:10px;font-size:14px;color:#cbd5e1}
    @media(max-width:600px){
      textarea{height:100px;}
    }
  </style>
</head>
<body>
  <h1>üéôÔ∏è Traducteur temps r√©el ‚Äî Anglais ‚Üí Fran√ßais</h1>
  <div class="card">
    <p>Parle en anglais au micro, et la traduction fran√ßaise appara√Ætra en dessous.</p>
    <div>
      <button id="startBtn" class="start">D√©marrer</button>
      <button id="stopBtn" class="stop" disabled>Arr√™ter</button>
    </div>
    <h3>Texte d√©tect√© (anglais)</h3>
    <textarea id="transcript" readonly></textarea>
    <h3>Traduction (fran√ßais)</h3>
    <textarea id="translation" readonly></textarea>
    <div class="status" id="status">√âtat : inactif</div>
  </div>

<script>
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognizer, recognizing=false;
const startBtn=document.getElementById('startBtn');
const stopBtn=document.getElementById('stopBtn');
const transcriptEl=document.getElementById('transcript');
const translationEl=document.getElementById('translation');
const statusEl=document.getElementById('status');

function initRecog(){
  recognizer=new SpeechRecognition();
  recognizer.lang='en-US';
  recognizer.continuous=true;
  recognizer.interimResults=true;
  recognizer.onstart=()=>{
    recognizing=true;statusEl.textContent='√âtat : √©coute‚Ä¶';
    startBtn.disabled=true;stopBtn.disabled=false;
  };
  recognizer.onend=()=>{
    recognizing=false;statusEl.textContent='√âtat : inactif';
    startBtn.disabled=false;stopBtn.disabled=true;
  };
  recognizer.onresult=(e)=>{
    let interim='',final='';
    for(let i=e.resultIndex;i<e.results.length;i++){
      const res=e.results[i];
      if(res.isFinal){final+=res[0].transcript;}else{interim+=res[0].transcript;}
    }
    transcriptEl.value=(transcriptEl.value+' '+final+' '+interim).trim();
    if(final.trim()) translate(final.trim());
  };
}

async function translate(txt){
  statusEl.textContent='Traduction en cours‚Ä¶';
  try{
    const r=await fetch("https://translate.argosopentech.com/translate",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({q:txt,source:"en",target:"fr",format:"text"})
    });
    const d=await r.json();
    translationEl.value+=(translationEl.value?'\n':'')+d.translatedText;
    statusEl.textContent='√âtat : traduction OK';
  }catch(e){
    statusEl.textContent='Erreur traduction';
  }
}

startBtn.onclick=async()=>{
  try{
    await navigator.mediaDevices.getUserMedia({audio:true});
    if(!recognizer) initRecog();
    recognizer.start();
  }catch(e){statusEl.textContent='Micro non disponible';}
};
stopBtn.onclick=()=>recognizer.stop();
</script>
</body>
</html>
